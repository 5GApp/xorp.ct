%
% $XORP: xorp/docs/user_manual/pimsm.tex,v 1.10 2005/04/07 03:09:12 pavlin Exp $
%

\chapter{PIM Sparse-Mode}
\label{pimsm}

\section{Terminology and Concepts}

PIM stands for {\it Protocol Independent Multicast}, and denotes a
class of multicast routing protocols.  The term {\it protocol
independent} comes from the fact that PIM does not have its own
topology discovery protocol, but instead relies on routing information
supplied by protocols such as RIP and BGP.  What PIM does do is to
build multicast trees from senders to receivers based on paths
determined by this external topology information.  

There are two PIM protocols:
\begin{itemize}
\item PIM Sparse-Mode (PIM-SM) is the most commonly used multicast
  routing protocol, and explicitly builds distribution trees from the
  receivers back towards senders.
\item PIM Dense-Mode (PIM-DM) is less commonly used, and builds trees
  by flooding multicast traffic domain-wide, and then pruning off
  branches from the tree where there are no receivers.  
\end{itemize}
At the present time, XORP only implements PIM Sparse Mode.

\subsection{PIM-SM Protocol Overview}

{\it The following description is adapted from the PIM-SM
  specification.  }

PIM-SM relies on an underlying topology-gathering protocol to populate a
routing table with routes.  This routing table is called the {\it MRIB} or
{\it Multicast Routing Information Base}.  The routes in this table may be
taken directly from the unicast routing table, or it may be
different and provided by a separate routing protocol such as
Multiprotocol BGP.

Regardless of how it is created, the primary role of the MRIB in the
PIM-SM protocol
is to provide the next-hop router along a multicast-capable
path to each destination subnet.
The MRIB is used to determine the next-hop neighbor to which any PIM
Join/Prune message is sent.
Data flows along the reverse path of the Join messages.
Thus, in contrast to the unicast RIB which specifies the
next-hop that a data packet would take to get {\it to} some subnet,
the MRIB gives reverse-path information, and indicates the path that
a multicast data packet would take {\it from} 
its origin subnet to the router that has the MRIB.  

Like all multicast routing protocols that implement the ASM service model,
PIM-SM must be able to route data packets from sources to receivers
without either the sources or receivers knowing a-priori of the
existence of the others.  This is essentially done in three phases,
although as senders and receivers may come and go at any time, all
three phases may be occur simultaneously.

\subsubsection*{Phase One: RP Tree}

In phase one, a multicast receiver expresses its interest in receiving
traffic destined for a multicast group.  Typically it does this using
IGMP or MLD.  One of the receiver's local PIM routers is elected as the
Designated Router (DR) for that subnet.  On receiving the receiver's
expression of interest, the DR then sends a PIM Join message towards
the Rendezvous Point (RP) for that multicast group.  The RP is a
PIM-SM router that has been configured to serve a bootstrapping role
for certain multicast groups.  This Join message is known as a (*,G)
Join because it joins group G for all sources to that group.  The
(*,G) Join travels hop-by-hop towards the RP for the group, and in
each router it passes through, multicast tree state for group G is
instantiated.  Eventually the (*,G) Join either reaches the RP, or
reaches a router that already has (*,G) Join state for that group.
When many receivers join the group, their Join messages converge on
the RP, and form a distribution tree for group G that is rooted at the
RP.  This is known as the RP Tree (RPT), and is also known as the
shared tree because it is shared by all sources sending to that group.
Join messages are resent periodically so long as the receiver remains
in the group.  When all receivers on a leaf-network leave the group,
the DR will send a PIM (*,G) Prune message towards the RP for that
multicast group. However if the Prune message is not sent for any
reason, the state will eventually time out.

A multicast data sender just starts sending data destined for a
multicast group.  The sender's local router (DR) takes those data
packets, unicast-encapsulates them, and sends them directly to the RP.
The RP receives these encapsulated data packets, decapsulates them,
and forwards them onto the shared tree.  The packets then follow the
(*,G) multicast tree state in the routers on the RP Tree, being
replicated wherever the RP Tree branches, and eventually reaching all
the receivers for that multicast group.  The process of encapsulating
data packets to the RP is called {\it registering}, and the encapsulation
packets are known as PIM Register packets.  

At the end of phase one, multicast traffic is flowing encapsulated to
the RP, and then natively over the RP tree to the multicast receivers.

\subsubsection*{Phase Two: Register-Stop}

Register-encapsulation of data packets is inefficient for two reasons:
\begin{itemize}
\item Encapsulation and decapsulation may be relatively expensive
operations for a router to perform, depending on whether or not the
router has appropriate hardware for these tasks.

\item Traveling all the way to the RP, and then back down the shared
tree may entail the packets traveling a relatively long distance to
reach receivers that are close to the sender.  For some applications,
this increased latency is undesirable.
\end{itemize}
Although Register-encapsulation may continue indefinitely, for the
reasons above, the RP will normally choose to switch to native forwarding.
To do this, when the RP receives a register-encapsulated data packet
from source S on group G, it will normally initiate an (S,G)
source-specific Join towards S.  This Join message travels hop-by-hop
towards S, instantiating (S,G) multicast tree state in the routers
along the path.  (S,G) multicast tree state is used only to forward
packets for group G if those packets come from source S.  Eventually
the Join message reaches S's subnet or a router that already has (S,G)
multicast tree state, and then packets from S start to flow following
the (S,G) tree state towards the RP.  These data packets may also
reach routers with (*,G) state along the path towards the RP - if so,
they can short-cut onto the RP tree at this point.

While the RP is in the process of joining the source-specific tree for
S, the data packets will continue being encapsulated to the RP.
When packets from S also start to arrive natively at the the RP, the
RP will be receiving two copies of each of these packets.  At this
point, the RP starts to discard the encapsulated copy of these
packets, and it sends a {\it Register-Stop} message back to S's DR to
prevent the DR unnecessarily encapsulating the packets.

At the end of phase 2, traffic will be flowing natively from S along a
source-specific tree to the RP, and from there along the shared tree
to the receivers.  Where the two trees intersect, traffic may transfer
from the source-specific tree to the RP tree, and so avoid taking a
long detour via the RP.

It should be noted that a sender may start sending before or after a
receiver joins the group, and thus phase two may happen before the
shared tree to the receiver is built.

\subsubsection*{Phase 3: Shortest-Path Tree}

Although having the RP join back towards the source removes the
encapsulation overhead, it does not completely optimize the forwarding
paths.  For many receivers the route via the RP may involve a
significant detour when compared with the shortest path from the
source to the receiver.  

To obtain lower latencies, a router on the receiver's LAN, typically
the DR, may optionally initiate a transfer from the shared tree to a
source-specific shortest-path tree (SPT).  To do this, it issues an
(S,G) Join towards S.  This instantiates state in the routers along
the path to S.  Eventually this join either reaches S's subnet, or
reaches a router that already has (S,G) state.  When this happens,
data packets from S start to flow following the (S,G) state until they
reach the receiver.

At this point the receiver (or a router upstream of the receiver) will
be receiving two copies of the data - one from the SPT and one from
the RPT.  When the first traffic starts to arrive from the SPT, the DR
or upstream router starts to drop the packets for G from S that arrive
via the RP tree.  In addition, it sends an (S,G) Prune message towards
the RP.  This is known as an (S,G,rpt) Prune.  The Prune message
travels hop-by-hop, instantiating state along the path towards the RP
indicating that traffic from S for G should NOT be forwarded in this
direction.  The prune is propagated until it reaches the RP or a
router that still needs the traffic from S for other receivers.

By now, the receiver will be receiving traffic from S along the
shortest-path tree between the receiver and S.  In addition, the RP is
receiving the traffic from S, but this traffic is no longer reaching
the receiver along the RP tree.  As far as the receiver is concerned,
this is the final distribution tree.

\subsubsection{Multi-access Transit LANs}

The overview so far has concerned itself with point-to-point links.
However, using multi-access LANs such as Ethernet for transit is not
uncommon.  This can cause complications for three reasons:
\begin{itemize}
\item Two or more routers on the LAN may issue (*,G) Joins to different
upstream routers on the LAN because they have inconsistent MRIB
entries regarding how to reach the RP.  Both paths on the RP tree will
be set up, causing two copies of all the shared tree traffic to appear
on the LAN.
\item Two or more routers on the LAN may issue (S,G) Joins to different
upstream routers on the LAN because they have inconsistent MRIB
entries regarding how to reach source S.  Both paths on the
source-specific tree will be set up, causing two copies of all the
traffic from S to appear on the LAN.
\item A router on the LAN may issue a (*,G) Join to one upstream router on
the LAN, and another router on the LAN may issue an (S,G) Join to a
different upstream router on the same LAN.  Traffic from S may reach
the LAN over both the RPT and the SPT.  If the receiver behind the
downstream (*,G) router doesn't issue an (S,G,rpt) prune, then this
condition would persist.
\end{itemize}
All of these problems are caused by there being more than one upstream
router with join state for the group or source-group pair.  PIM-SM does
not prevent such duplicate joins from occurring - instead when
duplicate data packets appear on the LAN from different routers, these
routers notice this, and then elect a single forwarder.  This election
is performed using PIM {\it Assert} messages, which resolve the problem in
favor of the upstream router which has (S,G) state, or if neither or
both router has (S,G) state, then in favor of the router with the best
metric to the RP for RP trees, or the best metric to the source to
source-specific trees.

These Assert messages are also received by the downstream routers on
the LAN, and these cause subsequent Join messages to be sent to the
upstream router that won the Assert.

\subsection*{RP Discovery}

PIM-SM routers need to know the address of the RP for each group for
which they have (*,G) state.  This address is obtained either through
a bootstrap mechanism or through static configuration.

One dynamic way to do this is to use the {\it Bootstrap Router} (BSR)
mechanism. 
One router in each PIM-SM domain is elected the Bootstrap Router through
a simple election process.  All the routers in the domain that are
configured to be candidates to be RPs periodically unicast their
candidacy to the BSR.  From the candidates, the BSR picks an RP-set,
and periodically announces this set in a Bootstrap message.  Bootstrap
messages are flooded hop-by-hop throughout the domain until all
routers in the domain know the RP-Set.

To map a group to an RP, a router hashes the group address into the
RP-set using an order-preserving hash function (one that minimizes
changes if the RP-Set changes).  The resulting RP is the one that it
uses as the RP for that group.

\section{Standards}

XORP is compliant with the following PIM-SM specification:
\begin{description}
\item{\bf draft-ietf-pim-sm-v2-new-10}.  Protocol Independent
  Multicast - Sparse Mode (PIM-SM): Protocol Specification (Revised).
\item{\bf draft-ietf-pim-sm-bsr-02}.  Bootstrap Router (BSR) Mechanism
  for PIM Sparse Mode.
\end{description}

\section{Configuring PIM-SM}
\subsection{Configuration Syntax}

\vspace{0.1in}
\noindent\framebox[\textwidth][l]{\scriptsize
\begin{minipage}{4.5in}
\begin{alltt}
\begin{tabbing}
xx\=xx\=xx\=xx\=xx\=\kill
protocols \{\\
\>pimsm4 \{\\
\>\>targetname: {\it text}\\
\>\>disable: {\it bool}\\
\>\>interface {\it text} \{\\
\>\>\>vif {\it text} \{\\
\>\>\>\>disable: {\it bool}\\
\>\>\>\>dr-priority: {\it uint}\\
\>\>\>\>alternative-subnet {\it IPv4}/{\it int(0..32)}\\
\>\>\>\}\\
\>\>\}\\
\>\>interface register\_vif \{\\
\>\>\>vif register\_vif \{\\
\>\>\>\>disable: {\it bool}\\
\>\>\>\}\\
\>\>\}\\
\\
\>\>static-rps \{\\
\>\>\>rp {\it IPv4} \{\\
\>\>\>\>group-prefix {\it IPv4Mcast}/{\it int(4..32)} \{\\
\>\>\>\>\>rp-priority: {\it uint(0..255)}\\
\>\>\>\>\>hash-mask-len: {\it uint(4..32)}\\
\>\>\>\>\}\\
\>\>\>\}\\
\>\>\}\\
\\
\>\>bootstrap \{\\
\>\>\>disable: {\it bool}\\
\>\>\>cand-bsr \{\\
\>\>\>\>scope-zone  {\it IPv4Mcast}/{\it int(4..32)} \{\\
\>\>\>\>\>is-scope-zone: {\it bool}\\
\>\>\>\>\>cand-bsr-by-vif-name: {\it text}\\
\>\>\>\>\>bsr-priority: {\it uint(0..255)}\\
\>\>\>\>\>hash-mask-len: {\it uint(4..32)}\\
\>\>\>\>\}\\
\>\>\>\}\\
\\
\>\>\>cand-rp \{\\
\>\>\>\>group-prefix  {\it IPv4Mcast}/{\it int(4..32)} \{\\
\>\>\>\>\>is-scope-zone: {\it bool}\\
\>\>\>\>\>cand-rp-by-vif-name: {\it text}\\
\>\>\>\>\>rp-priority: {\it uint(0..255)}\\
\>\>\>\>\>rp-holdtime: {\it uint(0..65535)}\\
\>\>\>\>\}\\
\>\>\>\}\\
\>\>\}\\
\\
\>\>switch-to-spt-threshold \{\\
\>\>\>disable: {\it bool}\\
\>\>\>interval-sec: {\it uint(3..2147483647)}\\
\>\>\>bytes: {\it uint}\\
\>\>\}\\
\\
{\rm continued overleaf....}
\end{tabbing}
\end{alltt}
\end{minipage}
}
\newpage
\vspace{0.1in}
\noindent\framebox[\textwidth][l]{\scriptsize
\begin{minipage}{4.5in}
\begin{alltt}
\begin{tabbing}
xx\=xx\=xx\=xx\=xx\=\kill
\>\>traceoptions \{\\
\>\>\>flag all \{\\
\>\>\>\>disable: {\it bool}\\
\>\>\>\}\\
\>\>\}\\
\>\}\\
\}
\\
\\
protocols \{\\
\>pimsm6 \{\\
\>\>disable: {\it bool}\\
\>\>interface {\it text} \{\\
\>\>\>vif {\it text} \{\\
\>\>\>\>disable: {\it bool}\\
\>\>\>\>dr-priority: {\it uint}\\
\>\>\>\>alternative-subnet  {\it IPv6}/{\it int(0..128)}\\
\>\>\>\}\\
\>\>\}\\
\>\>interface register\_vif \{\\
\>\>\>vif register\_vif \{\\
\>\>\>\>disable: {\it bool}\\
\>\>\>\}\\
\>\>\}\\
\\
\>\>static-rps \{\\
\>\>\>rp {\it IPv6} \{\\
\>\>\>\>group-prefix  {\it IPv6Mcast}/{\it int(8..128)} \{\\
\>\>\>\>\>rp-priority: {\it uint(0..255)}\\
\>\>\>\>\>hash-mask-len: {\it uint(8..128)}\\
\>\>\>\>\}\\
\>\>\>\}\\
\>\>\}\\
\\
\>\>bootstrap \{\\
\>\>\>disable: {\it bool}\\
\>\>\>cand-bsr \{\\
\>\>\>\>scope-zone {\it IPv6Mcast}/{\it int(8..128)} \{\\
\>\>\>\>\>is-scope-zone: {\it bool}\\
\>\>\>\>\>cand-bsr-by-vif-name: {\it text}\\
\>\>\>\>\>bsr-priority: {\it uint(0..255)}\\
\>\>\>\>\>hash-mask-len: {\it uint(8..128)}\\
\>\>\>\>\}\\
\>\>\>\}\\
\\
\>\>\>cand-rp \{\\
\>\>\>\>group-prefix {\it IPv6Mcast}/{\it int(8..128)} \{\\
\>\>\>\>\>is-scope-zone: {\it bool}\\
\>\>\>\>\>cand-rp-by-vif-name: {\it text}\\
\>\>\>\>\>rp-priority: {\it uint(0..255)}\\
\>\>\>\>\>rp-holdtime: {\it uint(0..65535)}\\
\>\>\>\>\}\\
\>\>\>\}\\
\>\>\}\\
\\
\>\>switch-to-spt-threshold \{\\
\>\>\>disable: {\it bool}\\
\>\>\>interval-sec: {\it uint(3..2147483647)}\\
\>\>\>bytes: {\it uint}\\
\>\>\}\\
\\
\>\>traceoptions \{\\
\>\>\>flag all \{\\
\>\>\>\>disable: {\it bool}\\
\>\>\>\}\\
\>\>\}\\
\>\}\\
\}
\end{tabbing}
\end{alltt}
\end{minipage}
}
\vspace{0.1in}

\begin{description}
\item{\tt protocols}: this delimits the configuration for all routing
  protocols in the XORP router configuration.  It is mandatory that
  PIM-SM configuration is under the {\stt protocols} node in the
  configuration.
\item{\tt pimsm4}: this delimits the PIM-SM configuration part of the XORP
  router configuration related to IPv4 multicast.
\item{\tt targetname} this is the name for this instance of PIM-SM for
  IPv4.  It defaults to ``{\stt PIMSM\_4}'', and it is not recommended
  that this default is overridden under normal usage scenarios.
\item{\tt disable}: this takes the value {\stt true} or {\stt false},
  and indicates whether PIM-SM IPv4 multicast routing is currently
  disabled~\footnote{Note
  that prior to XORP Release-1.1, the {\tt enable} flag was used instead of
  {\tt disable}.}.
  This allows multicast to be taken down temporarily without
  removing the configuration.
\item{\tt interface}: this directive specifies that this {\stt
  interface} is to be used for PIM-SM IPv4 multicast routing.  The
  parameter value must be the name of an interface that has been
  configured in the {\stt interfaces} section of the router
  configuration.
\item{\tt vif}: this directive specifies that this {\stt vif}
  on the specified {\stt interface} is to be used for PIM-SM IPv4
  multicast routing.  The parameter value must be the name of a vif
  that has been configured in the {\stt interfaces} section of the
  router configuration.

  A special logical interface called {\stt register\_vif} with a
  special vif called {\stt register\_vif} must be configured if a
  PIM-SM router is to be able to send Register messages to the RP.  In
  general this should {\it always} be configured if the router is to
  support the ASM multicast service model.

  Each {\stt vif} can take the following optional parameters:
\begin{description}
\item{\tt disable}: this takes the value {\stt true} or {\stt false},
  and indicates whether PIM-SM IPv4 multicast routing is currently
  disabled on this interface/vif~\footnote{Note
  that prior to XORP Release-1.1, the {\tt enable} flag was used instead of
  {\tt disable}.}.
\item{\tt dr-priority}: this directive takes a non-negative integer as
  its parameter giving this router's Designated Router (DR) priority
  for this interface/vif.  The default is 1.  The PIM router on this
  subnet with the highest value of DR priority will become the DR for
  the subnet.
\item{\tt alternative-subnet}: this directive is used to associate
  additional IP subnets with a network interface. The parameter value
  is an IPv4 subnet address in the {\it address/prefix-length} format.

  One use of this directive is to make incoming traffic with a
  non-local source address appear as it is coming from a local
  subnet. Typically, this is needed as a work-around solution when
  uni-directional interfaces such as satellite links are used for
  receiving traffic.  The {\stt alternative-subnet} directive should be
  used with extreme care, because it is possible to create forwarding
  loops.
\end{description}
\item{\tt static-rps}: this delimits the part of the PIM-SM
  configuration used to manually configure PIM RP router information.
  A PIM-SM router must either have some RPs configured as static RPs,
  or it must run the PIM-SM bootstrap mechanism (see the {\stt
  bootstrap} directive).  

  Under the {\stt static-rps} part of the configuration, one or more
  RPs can be configured.  It is important that all routers in a PIM
  domain make the same choice of RP for the same multicast group, so
  generally they should be configured with the same RP information.
\begin{description}
\item{\tt rp}: this specifies the IPv4 address of a router to be a
  static RP.  

  For each RP, the following parameters can be configured:
\begin{description}
\item{\tt group-prefix}: this specifies the range of multicast
  addresses for which the specified router is willing to be the RP.
  The value is in the form of an IP address and prefix-length in the
  {\it address/prefix-length} format.
\begin{description}
\item{\tt rp-priority}: this specifies the priority of the specified
  RP router.  It takes the form of a non-negative integer in the
  interval [0, 255].

  If multiple RP routers are known for a particular multicast group,
  then the one with the most specific {\stt group-prefix} will be
  used.  If more than one router has the same most specific {\stt
  group-prefix}, then the one with the highest {\stt rp-priority} is
  used.  See also {\stt hash-mask-len}.

  The default value is 192.
\item{\tt hash-mask-len}: If multiple routers have the most specific
  {\stt group-prefix} and the same highest {\stt rp-priority}, then to
  balance load, a hash function is used to choose the RP.  However, it
  is usually desirable for closely associated multicast groups to use
  the same RP.  Thus the hash function is only applied to the first
  $n$ bits of the group IP address, ensuring that if two groups have
  the same first $n$ bits, they will hash to the same RP address.  The
  {\stt hash-mask-len} parameter specifies the value of $n$.
  For IPv4 it must be in the interval [4, 32], and defaults to 30 bits.
  Typically its value shouldn't be changed.
  If it is modified then all PIM-SM routers must be configured with the
  same value.
\end{description}
\end{description}
\end{description}
\item{\tt bootstrap}: this delimits the part of the PIM-SM
  configuration used to configure the automatic bootstrap of PIM RP
  router information using the PIM {\it BootStrap Router} mechanism.  A
  PIM-SM router must either run the PIM-SM bootstrap mechanism, or
  have some RPs configured as static RPs (see the {\stt static-rps}
  directive).

  Under the {\stt bootstrap} directive, the following additional
  information can be configured.
\begin{description}
\item{\tt disable}: this takes the value {\stt true} or {\stt false},
  and determines whether or not the router will run the {\stt
  bootstrap} mechanism~\footnote{Note
  that prior to XORP Release-1.1, the {\tt enable} flag was used instead of
  {\tt disable}.}.  The default is {\stt false}.
\item{\tt cand-bsr}: this directive specifies that this router is to
  be a candidate to be the BootStrap Router (BSR) for this PIM-SM domain.
  It will become the BSR only if it wins the BSR election process.

  One or more {\stt scope-zone}s must be specified for a candidate BSR
  router:
\begin{description}
\item{\tt scope-zone}: this directive specifies one multicast group
  prefix for which this router is willing to be BSR. 
 
  For each scope zone, the following infomation can be specified: 
\begin{description}
\item{\tt is-scope-zone}: this directive takes the value {\stt true}
  or {\stt false}.  When the value is {\stt true}, this indicates that
  this multicast group prefix defines a multicast scope zone.  When
  the value is {\stt false}, this indicates that the group prefix in
  the {\stt scope-zone} directive merely represents a range of
  multicast groups for which this router is willing to be BSR.  The
  default is {\stt false}.
\item{\tt cand-bsr-by-vif-name}: this specifies the name of the {\stt
  vif} whose IP address will be used in the PIM bootstap messages.  It
  is a mandatory parameter.
\item{\tt bsr-priority}: this specifies the BSR priority for this
  router.  It takes a positive integer value in the interval [0, 255],
  which is used in the
  PIM-SM BSR election process.  For each {\stt scope-zone}, the
  candidate bootstrap router with the highest BSR priority will be
  chosen to be BSR. Its default value is 1.
\item{\tt hash-mask-len}: The BSR mechanism announces a list of
  candicate RPs (C-RPs) for each scope zone to the other routers in
  the scope zone.  To balance load, those routers then use a hash
  function to choose the RP for each multicast group from amongst the
  C-RPs.  However, it is usually desirable for closely associated
  multicast groups to use the same RP.  Thus the hash function is only
  applied to the first $n$ bits of the group IP address, ensuring that
  if two groups have the same first $n$ bits, they will hash to the
  same RP address.  Should this router become the BSR for this
  scope-zone, the {\stt hash-mask-len} parameter gives the value of
  $n$ that this router will inform other routers they must use.
  For IPv4 it must be in the interval [4, 32], and defaults to 30 bits.
  Typically its value shouldn't be changed.
  If it is modified then all PIM-SM routers must be configured with the
  same value.
\end{description}
\end{description}
\end{description}
\item{\tt cand-rp}: this directive specifies that this router is to be
  a candidate to be an RP for this PIM-SM domain.  It will become an
  RP only if the BSR chooses it to be.  

  One or more group-prefixes must be specified for this router
  to function as an RP:
\begin{description}
\item{\tt group-prefix}: this specifies the range of multicast
  addresses for which the specified router is willing to be the RP.
  The value is in the form of an IP address and prefix length in the
  {\it address/prefix-length} format.  

  For each {\stt group-prefix}, the following parameters can be
  specified:
\begin{description}
\item{\tt is-scope-zone}: this directive takes the value {\stt true}
  or {\stt false}.  When the value is {\stt true}, this indicates that
  this multicast group prefix defines a multicast scope zone.  When
  the value is {\stt false}, this indicates that the group prefix in
  the {\stt scope-zone} directive merely represents a range of
  multicast groups for which this router is willing to be RP.  The
  default is {\stt false}.
\item{\tt cand-rp-by-vif-name}: this specifies the name of the {\stt
  vif} whose IP address will be used as the RP address if this router
  becomes an RP.  It is a mandatory parameter.
\item{\tt rp-priority}: this specifies the RP priority of this router
  for this {\stt group-prefix}.  It takes the form of a non-negative
  integer in the interval [0, 255].

  If multiple RP routers are known for a particular multicast group,
  then the one with the most specific {\stt group-prefix} will be
  used.  If more than one router has the same most specific {\stt
  group-prefix}, then the one with the highest {\stt rp-priority} is
  used.  See also {\stt hash-mask-len}.

  The default value for {\stt rp-priority} is 1.
\item{\tt rp-holdtime}: this specifies the holdtime that this router
  will advertise when talking to the BSR.  If the BSR has not heard a
  Candidate RP Advertisement from this router for {\stt rp-holdtime}
  seconds, then the BSR will conclude it is dead, and will remove it
  from the set of possible RPs.  It takes the form of a non-negative
  integer in the interval [0, 65535] and its default value is 150 seconds.
\end{description}
\end{description}
\item{\tt switch-to-spt-threshold}: this directive permits the
  specification of a bitrate threshold at a last-hop router or RP
  for switching from the RP Tree to the Shortest-Path Tree.  The
  following parameters can be specified:
\begin{description}
\item{\tt disable}: this takes the value {\stt true} or {\stt false},
  and determines whether bitrate-based switching to the shortest
  path tree is disabled~\footnote{Note
  that prior to XORP Release-1.1, the {\tt enable} flag was used instead of
  {\tt disable}.}.  The default is false.
\item{\tt interval-sec}: this specifies the measurement interval in
  seconds for measuring the bitrate of traffic from a  multicast
  sender.  The measurement interval should normally not be set too
  small - values greater than ten seconds are recommended.
  It takes the form of a non-negative integer in the interval
  [3, 2147483647] and its default value is 100 seconds.
\item{\tt bytes}: this specifies the maximum number of bytes from a
  multicast sender that can be received in {\stt interval-sec}
  seconds.  If this threshold is exceeded, the router will attempt to
  switch to the shortest-path tree from that multicast sender.
  If the shortest-path switch should happen right after the first packet
  is forwarded, then {\stt bytes} should be set to 0.
\end{description}
\item{\tt traceoptions}: this directive delimits the configuration of
  debugging and tracing options for PIM-SM.
\begin{description}
\item{\tt flag}: this directive is used to specify which tracing
  options are enabled.  Possible parameters are:
\begin{description}
\item{\tt all}: this directive specifies that all tracing
  options should be enabled.  Possible parameters are:
\begin{description}
\item{\tt disable}: this takes the value {\stt true} or {\stt false},
  and disables or enables tracing~\footnote{Note
  that prior to XORP Release-1.1, the {\tt enable} flag was used instead of
  {\tt disable}.}. The default is {\stt false}.
\end{description}
\end{description}
\end{description}
\end{description}

The configuration parameters for PIM-SM for IPv6 are the same as those
for IPv4, except for the following:
\begin{itemize}
\item The {\stt pimsm6} directive for IPv6 is used in place of the
  {\stt pimsm4} directive for IPv4.
\item The default value of {\stt targetname} is ``{\stt PIMSM\_6}''
  instead of ``{\stt PIMSM\_4}''
\item All IP addresses used in configuration are IPv6 addresses
  instead of IPv4 addresses.
\item The {\stt hash-mask-len} value must be in the interval [8, 128],
  and defaults to 126.
\end{itemize}

\newpage
\subsection{Example Configurations}

\vspace{0.1in}
\noindent\framebox[\textwidth][l]{\scriptsize
\begin{minipage}{4.5in}
\begin{alltt}
\begin{tabbing}
xx\=xx\=xx\=xx\=xx\=\kill
protocols \{\\
\>pimsm4 \{\\
\>\>disable: false\\
\>\>interface dc0 \{\\
\>\>\>vif dc0 \{\\
\>\>\>\>disable: false\\
\>\>\>\>/* dr-priority: 1 */\\
\>\>\>\>/* alternative-subnet 10.40.0.0/16 */\\
\>\>\>\}\\
\>\>\}\\
\>\>interface register\_vif \{\\
\>\>\>vif register\_vif \{\\
\>\>\>\>/* Note: this vif should be always enabled */\\
\>\>\>\>disable: false\\
\>\>\>\}\\
\>\>\}\\
\\
\>\>static-rps \{\\
\>\>\>rp 10.60.0.1 \{\\
\>\>\>\>group-prefix 224.0.0.0/4 \{\\
\>\>\>\>\>/* rp-priority: 192 */\\
\>\>\>\>\>/* hash-mask-len: 30 */\\
\>\>\>\>\}\\
\>\>\>\}\\
\>\>\}\\
\\
\>\>bootstrap \{\\
\>\>\>disable: false\\
\>\>\>cand-bsr \{\\
\>\>\>\>scope-zone 224.0.0.0/4 \{\\
\>\>\>\>\>/* is-scope-zone: false */\\
\>\>\>\>\>cand-bsr-by-vif-name: "dc0"\\
\>\>\>\>\>/* bsr-priority: 1 */\\
\>\>\>\>\>/* hash-mask-len: 30 */\\
\>\>\>\>\}\\
\>\>\>\}\\
\\
\>\>\>cand-rp \{\\
\>\>\>\>group-prefix 224.0.0.0/4 \{\\
\>\>\>\>\>/* is-scope-zone: false */\\
\>\>\>\>\>cand-rp-by-vif-name: "dc0"\\
\>\>\>\>\>/* rp-priority: 192 */\\
\>\>\>\>\>/* rp-holdtime: 150 */\\
\>\>\>\>\}\\
\>\>\>\}\\
\>\>\}\\
\\
\>\>switch-to-spt-threshold \{\\
\>\>\>/* approx. 1K bytes/s (10Kbps) threshold */\\
\>\>\>disable: false\\
\>\>\>interval-sec: 100\\
\>\>\>bytes: 102400\\
\>\>\}\\
\\
{\rm continued overleaf....}
\end{tabbing}
\end{alltt}
\end{minipage}
}
\newpage
\vspace{0.1in}
\noindent\framebox[\textwidth][l]{\scriptsize
\begin{minipage}{4.5in}
\begin{alltt}
\begin{tabbing}
xx\=xx\=xx\=xx\=xx\=\kill
\>\>traceoptions \{\\
\>\>\>flag all \{\\
\>\>\>\>disable: false\\
\>\>\>\}\\
\>\>\}\\
\>\}\\
\}
\\
\\
protocols \{\\
\>pimsm6 \{\\
\>\>disable: false\\
\>\>interface dc0 \{\\
\>\>\>vif dc0 \{\\
\>\>\>\>disable: false\\
\>\>\>\>/* dr-priority: 1 */\\
\>\>\>\>/* alternative-subnet 40:40:40:40::/64 */\\
\>\>\>\}\\
\>\>\}\\
\>\>interface register\_vif \{\\
\>\>\>vif register\_vif \{\\
\>\>\>\>/* Note: this vif should be always enabled */\\
\>\>\>\>disable: false\\
\>\>\>\}\\
\>\>\}\\
\\
\>\>static-rps \{\\
\>\>\>rp 50:50:50:50:50:50:50:50 \{\\
\>\>\>\>group-prefix ff00::/8 \{\\
\>\>\>\>\>/* rp-priority: 192 */\\
\>\>\>\>\>/* hash-mask-len: 126 */\\
\>\>\>\>\}\\
\>\>\>\}\\
\>\>\}\\
\\
\>\>bootstrap \{\\
\>\>\>disable: false\\
\>\>\>cand-bsr \{\\
\>\>\>\>scope-zone ff00::/8 \{\\
\>\>\>\>\>/* is-scope-zone: false */\\
\>\>\>\>\>cand-bsr-by-vif-name: "dc0"\\
\>\>\>\>\>/* bsr-priority: 1 */\\
\>\>\>\>\>/* hash-mask-len: 30 */\\
\>\>\>\>\}\\
\>\>\>\}\\
\\
\>\>\>cand-rp \{\\
\>\>\>\>group-prefix ff00::/8 \{\\
\>\>\>\>\>/* is-scope-zone: false */\\
\>\>\>\>\>cand-rp-by-vif-name: "dc0"\\
\>\>\>\>\>/* rp-priority: 192 */\\
\>\>\>\>\>/* rp-holdtime: 150 */\\
\>\>\>\>\}\\
\>\>\>\}\\
\>\>\}\\
\\
\>\>switch-to-spt-threshold \{\\
\>\>\>/* approx. 1K bytes/s (10Kbps) threshold */\\
\>\>\>disable: false\\
\>\>\>interval-sec: 100\\
\>\>\>bytes: 102400\\
\>\>\}\\
\\
\>\>traceoptions \{\\
\>\>\>flag all \{\\
\>\>\>\>disable: false\\
\>\>\>\}\\
\>\>\}\\
\>\}\\
\}
\end{tabbing}
\end{alltt}
\end{minipage}
}
\vspace{0.1in}

\section{Monitoring PIM-SM}

op-mode stuff.
