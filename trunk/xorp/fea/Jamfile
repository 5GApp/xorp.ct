#
# $XORP: xorp/fea/Jamfile,v 1.10 2007/05/01 16:56:51 bms Exp $
#

SubDir TOP fea ;
SubIncludeOnce TOP libxorp ;
SubIncludeOnce TOP libcomm ;
SubIncludeOnce TOP xrl interfaces ;
SubIncludeOnce TOP xrl targets ;
SubIncludeOnce TOP libxipc ;
SubIncludeOnce TOP libproto ;
SubIncludeOnce TOP libfeaclient ;
SubIncludeOnce TOP mrt ;
SubIncludeOnce TOP cli ;
SubIncludeOnce TOP cli libtecla ;
SubIncludeOnce TOP fea forwarding_plane ;
SubDir TOP fea ;

Library libfea : 
	addr_table.cc
	fea_io.cc
	fea_node.cc
	fibconfig.cc
	fibconfig_transaction.cc
	ifconfig.cc
	ifconfig_addr_table.cc
	ifconfig_reporter.cc
	ifconfig_transaction.cc
	iftree.cc
	libfeaclient_bridge.cc
	mfea_config.cc
	mfea_dataflow.cc
	mfea_mrouter.cc
	mfea_node.cc
	mfea_node_cli.cc
	mfea_proto_comm.cc
	mfea_vif.cc
	nexthop_port_mapper.cc
	pa_backend_dummy.cc
	pa_backend_ipfw2.cc
	pa_entry.cc
	pa_table.cc
	pa_transaction.cc
	profile_vars.cc
	rawsock.cc
	rawsock4.cc
	rawsock6.cc
	xrl_packet_acl.cc
	xrl_fea_io.cc
	xrl_fea_node.cc
	xrl_fea_target.cc
	xrl_fib_client_manager.cc
	xrl_mfea_node.cc
	xrl_rawsock4.cc
	xrl_rawsock6.cc
	xrl_socket_cmds.cc
	xrl_socket_server.cc
	;

FEA_LDADD =
	libfea
	libxorp_ifconfig
	libxorp_fibconfig
	libxorp_control_socket
	libfeafibclientxif
	libfearawpkt4client
	libfearawpkt6client
	libfeabase
	libclimanagerxif
	libmfeaclientxif
	libmfeabase
	libmrt
	libcli
	libtecla
	libcliprocessorxif
	libclibase
	libfeaclient
	libfeaifmgrmirrorxif
	libpacketaclbase
	libsocket4userxif
	libsocket4xif
	libsocket6userxif
	libsocket6xif
	libfindereventnotifierxif
	libsocketserverbase
	libprofileclientxif
	libproto
	libxipc
	libcomm
	libxorp
	;

Main xorp_fea : xorp_fea.cc ;
LinkLibraries xorp_fea : $(FEA_LDADD) ;

#
# Hack to build dummy FEA in Jam in a hopefully portable way.
#
# XXX: MainFromObjects supplies the SUFEXE suffix if and only if
# the filename is not explicitly gristed. Here, it has to be.
#
MainFromObjects <fea>xorp_fea_dummy$(SUFEXE) : <fea>fea_dummy$(SUFOBJ) ;
LinkLibraries <fea>xorp_fea_dummy$(SUFEXE) : $(FEA_LDADD) ;
Object <fea>fea_dummy$(SUFOBJ) : xorp_fea.cc ;
C++FLAGS on <fea>fea_dummy$(SUFOBJ) += -DFEA_DUMMY ;

if $(MAKE_CHECK) {

 Main test_xrl_sockets4_udp : test_xrl_sockets4_udp.cc ;
 LinkLibraries test_xrl_sockets4_udp :
	libfea
	libxorp_ifconfig
	libxorp_fibconfig
	libxorp_control_socket
	libsocket4userxif
	libsocket4xif
	libsocket6userxif
	libsocket6xif
	libfindereventnotifierxif
	libsocketserverbase
	libtestsocket4
	libxipc
	libcomm
	libxorp
	;

 Main test_xrl_sockets4_tcp : test_xrl_sockets4_tcp.cc ;
 LinkLibraries test_xrl_sockets4_tcp :
	libfea
	libxorp_ifconfig
	libxorp_fibconfig
	libxorp_control_socket
	libsocket4userxif
	libsocket4xif
	libsocket6userxif
	libsocket6xif
	libfindereventnotifierxif
	libsocketserverbase
	libtestsocket4
	libxipc
	libcomm
	libxorp
	;
} # MAKE_CHECK

InstallBin $(PREFIX)/fea :
	xorp_fea xorp_fea_click_config_generator xorp_fea_dummy ;

SubIncludeOnce TOP fea tools ;
